import{b as qe}from"./chunk-CIFQYWSU.js";import{c as P}from"./chunk-T7QTB5KA.js";import{a as D}from"./chunk-G2MQEQ3S.js";import{$ as j,B as ee,C as te,E as ie,F as ne,G as re,H as xe,Ka as pe,P as Le,T as q,V as E,W as O,X as F,Y as N,Z as w,b as be,ca as A,da as B,la as ae,ma as ze,n as Ve,na as Me,oa as oe,pa as se,pb as He,q as ve,qa as ce,sa as me,v as Fe,va as le,wa as Se}from"./chunk-EPUQ6IPG.js";import{Aa as H,Bb as Q,F as U,Fb as f,I as je,Ib as I,Jb as R,K as L,Ka as Be,Kb as a,Lb as o,Mb as v,Oc as Z,Qb as K,Tb as b,Vb as h,X as Ae,Y as C,_ as de,bc as Ce,cb as Pe,cc as m,dc as $,ea as J,ec as y,f as Y,fa as fe,fb as c,g as Re,gb as p,ja as V,k as W,ld as S,mc as Ge,md as ge,nc as Oe,o as _,pa as M,qa as _e,qd as Ue,s as $e,t as De,vc as g,wc as x,xb as u,xc as he,za as z,zb as d}from"./chunk-TYBYM3PM.js";import"./chunk-REV7FFDQ.js";import"./chunk-MON7YFGF.js";var We=(()=>{let i=class i{constructor(e){this.httpClient=e,this.baseUrl="/api/v1/chats"}getChatRooms(e,t){return this.httpClient.get(`${this.baseUrl}?teamId=${e}`,{params:Le(t)})}getHistoryMessages(e){return this.httpClient.get(`${this.baseUrl}/${e}/messages`)}getChatRoomById(e,t){return this.httpClient.get(`${this.baseUrl}/${t}`,{params:{teamId:e}})}updateChatRoom(e,t,r){return this.httpClient.put(`${this.baseUrl}/${t}`,r,{params:{teamId:e}})}deleteChatRoom(e,t){return this.httpClient.delete(`${this.baseUrl}/${t}`,{params:{teamId:e}})}sendMessage(e,t){return this.httpClient.post(`${this.baseUrl}/${e}/messages/send`,t)}deleteMessage(e,t,r){return this.httpClient.delete(`${this.baseUrl}/${e}/${t}/messages/${r}`)}updateMessage(e,t,r,l){return this.httpClient.put(`${this.baseUrl}/${e}/${t}/messages/${r}`,l)}readAllMessages(e){return this.httpClient.post(`${this.baseUrl}/${e}/messages/read`,{})}createChatRoom(e,t){return this.httpClient.post(`${this.baseUrl}`,t,{params:{teamId:e}})}};i.\u0275fac=function(t){return new(t||i)(V(be))},i.\u0275prov=J({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();var Xe=(()=>{let i=class i{constructor(e){this.httpClient=e,this.baseUrl="/api/v1/chats"}getHistoryMessages(e){return this.httpClient.get(`${this.baseUrl}/${e}/messages`)}sendMessage(e,t){return this.httpClient.post(`${this.baseUrl}/${e}/messages/send`,t)}deleteMessage(e,t,r){return this.httpClient.delete(`${this.baseUrl}/${e}/${t}/messages/${r}`)}updateMessage(e,t,r,l){return this.httpClient.put(`${this.baseUrl}/${e}/${t}/messages/${r}`,l)}readAllMessages(e){return this.httpClient.post(`${this.baseUrl}/${e}/messages/read`,{})}};i.\u0275fac=function(t){return new(t||i)(V(be))},i.\u0275prov=J({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();var G=(()=>{let i=class i{constructor(e,t,r,l){this.teamsService=e,this.chatsApiService=t,this.rxStompService=r,this.chatsMessagesApiService=l,this.refetchChatsSubject=new Y,this.currentChatRoomSubject=new Re(null),this.currentChatRoomMessagesSubject=new Re([]),this.refetchChats$=this.refetchChatsSubject.asObservable(),this.currentChatRoom$=this.currentChatRoomSubject.asObservable(),this.currentChatRoomMessages$=this.currentChatRoomMessagesSubject.asObservable()}subscribeCurrentChatMessages(){return this.currentChatRoom$.pipe(C(e=>e?this.subscribeToMessages(e.id):_(()=>Error("No current chat room"))))}sendMessageByCurrentChat(e){return this.currentChatRoom$.pipe(C(t=>t?this.chatsMessagesApiService.sendMessage(t.id,e):_(()=>Error("No current chat room"))))}updateMessage(e,t){return De([this.teamsService.currentTeam$,this.currentChatRoom$]).pipe(C(([r,l])=>l&&r?this.chatsMessagesApiService.updateMessage(r.id,l.id,e,t):_(()=>Error("No current chat room or team"))))}getHistoryMessages(){return this.currentChatRoom$.pipe(C(e=>e?this.chatsMessagesApiService.getHistoryMessages(e.id):_(()=>Error("No current chat room"))))}deleteMessage(e){return De([this.teamsService.currentTeam$,this.currentChatRoom$]).pipe(C(([t,r])=>r&&t?this.chatsMessagesApiService.deleteMessage(t.id,r.id,e):_(()=>Error("No current chat room or team"))))}readAllCurrentMessages(){return this.currentChatRoom$.pipe(C(e=>e?this.chatsMessagesApiService.readAllMessages(e.id):_(()=>Error("No current chat room"))))}subscribeToMessages(e){return this.rxStompService.watch(`/chats/${e}/messages`).pipe($e(t=>{let r=JSON.parse(t.body);return this.isChatMessageType(r)?r:null}))}isChatMessageType(e){return"id"in e&&"content"in e&&"status"in e&&"messageType"in e&&"eventType"in e&&"sentDate"in e}subscribeCurrentTeamChatsNotifications(){return this.teamsService.currentTeam$.pipe(C(e=>e?this.subscribeTeamNotifications(e.id):_(()=>Error("No current team room"))))}subscribeTeamNotifications(e){return this.rxStompService.watch(`/chats/teams/${e}/notifications`).pipe($e(t=>{let r=JSON.parse(t.body);return this.isTeamChatNotificationType(r)?r:null}))}isTeamChatNotificationType(e){return"teamId"in e&&"chatRoomId"in e&&"timestamp"in e&&"type"in e}setCurrentChat(e){e?e.id!==this.currentChatRoomSubject.value?.id&&(this.currentChatRoomSubject.next(e),this.currentChatRoomMessagesSubject.next([])):(this.currentChatRoomSubject.next(null),this.currentChatRoomMessagesSubject.next([]))}addMessage(e){Array.isArray(e)?this.currentChatRoomMessagesSubject.next([...this.currentChatRoomMessagesSubject.value,...e]):this.currentChatRoomMessagesSubject.next([...this.currentChatRoomMessagesSubject.value,e])}getChatRooms(e){return this.teamsService.currentTeam$.pipe(C(t=>t?this.chatsApiService.getChatRooms(t.id,e):_(()=>Error("No current team"))))}getChatRoomById(e){return this.teamsService.currentTeam$.pipe(C(t=>t?this.chatsApiService.getChatRoomById(t.id,e):_(()=>Error("No current team"))))}createChatRoom(e){return this.teamsService.currentTeam$.pipe(C(t=>t?this.chatsApiService.createChatRoom(t.id,e):_(()=>Error("No current team"))))}updateChatRoom(e,t){return this.teamsService.currentTeam$.pipe(C(r=>r?this.chatsApiService.updateChatRoom(r.id,e,t):_(()=>Error("No current team"))))}deleteChatRoom(e){return this.teamsService.currentTeam$.pipe(C(t=>t?this.chatsApiService.deleteChatRoom(t.id,e):_(()=>Error("No current team"))))}refetchChats(){this.refetchChatsSubject.next()}};i.\u0275fac=function(t){return new(t||i)(V(P),V(We),V(qe),V(Xe))},i.\u0275prov=J({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();var Ne=function(n){return n.TEXT="TEXT",n}(Ne||{});var Ct=(n,i)=>i.id;function gt(n,i){if(n&1&&(a(0,"mat-option",6),m(1),o()),n&2){let s=i.$implicit;d("value",s.id),c(),$(s.fullName)}}var Ze=(()=>{let i=class i{constructor(e,t,r,l){this.dialogRef=e,this.teamsService=t,this.data=r,this.toastService=l,this.form=new N({name:new w("",[E.required]),teamMembersIds:new w([],[E.required])}),this.members$=this.teamsService.getAllTeamMembersExceptCurrent(),this.patchExistingValues()}onBackClick(){this.dialogRef.close()}onSubmitClick(){let{name:e,teamMembersIds:t}=this.form.getRawValue();if(!e||!t){this.toastService.error("Missing required fields");return}let r={name:e,teamMembersIds:t};this.dialogRef.close(r)}patchExistingValues(){let e=this.data.chat;this.form.patchValue({name:e.name,teamMembersIds:e.membersIds})}};i.\u0275fac=function(t){return new(t||i)(p(ae),p(P),p(ze),p(D))},i.\u0275cmp=M({type:i,selectors:[["app-update-chat-dialog"]],decls:20,vars:4,consts:[["mat-dialog-title","",1,"update-chat__title"],["mat-dialog-content",""],[1,"update-chat__form",3,"formGroup"],["appearance","outline"],["matInput","","formControlName","name"],["formControlName","teamMembersIds","multiple",""],[3,"value"],["align","end"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary","cdkFocusInitial","",3,"click","disabled"]],template:function(t,r){t&1&&(a(0,"h1",0),m(1,` Update chat
`),o(),a(2,"section",1)(3,"form",2)(4,"mat-form-field",3)(5,"mat-label"),m(6,"Group Name"),o(),v(7,"input",4),o(),a(8,"mat-form-field",3)(9,"mat-label"),m(10,"Members"),o(),a(11,"mat-select",5),I(12,gt,2,2,"mat-option",6,Ct),g(14,"async"),o()()()(),a(15,"mat-dialog-actions",7)(16,"button",8),b("click",function(){return r.onBackClick()}),m(17," Back "),o(),a(18,"button",9),b("click",function(){return r.onSubmitClick()}),m(19," Update "),o()()),t&2&&(c(3),d("formGroup",r.form),c(9),R(x(14,2,r.members$)),c(6),d("disabled",r.form.invalid))},dependencies:[te,Se,le,me,pe,ee,oe,ce,se,j,q,O,F,A,B,S],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.update-chat__title[_ngcontent-%COMP%]{font-size:20px;font-weight:500}.update-chat__form[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:22px}"],changeDetection:0});let n=i;return n})();var bt=["currentTeamMemberId","","message","","prevMessage",""];function vt(n,i){n&1&&v(0,"img",3)}function xt(n,i){if(n&1&&(a(0,"div",5)(1,"p",11),m(2),o()()),n&2){let s=h(2);c(2),y(" ",s.isCurrentUserMessage?"You":s.message.senderFullName," ")}}function Mt(n,i){n&1&&(a(0,"mat-icon"),m(1,"check"),o())}function St(n,i){n&1&&v(0,"img",9)}function yt(n,i){if(n&1&&(a(0,"div",2),u(1,vt,1,0,"img",3),a(2,"div",4),u(3,xt,3,1,"div",5),a(4,"div",6)(5,"p",7),m(6),o(),a(7,"p",8),m(8),g(9,"date"),u(10,Mt,2,0,"mat-icon")(11,St,1,0,"img",9),o()()(),a(12,"mat-menu",null,0)(14,"button",10),m(15,"Delete"),o()()()),n&2){let s=h();Q("current-user__message",s.isCurrentUserMessage)("message-with-previous",s.isMessageFromPrevAuthor),c(),f(1,!s.isCurrentUserMessage&&!s.isMessageFromPrevAuthor?1:-1),c(2),f(3,s.isMessageFromPrevAuthor?-1:3),c(),Q("current-user__body",s.isCurrentUserMessage),c(2),y(" ",s.message.content," "),c(2),y(" ",he(9,12,s.message.sentDate,"H:mm")," "),c(2),f(10,s.message.status==="DELIVERED"&&s.isCurrentUserMessage?10:-1),c(),f(11,s.message.status==="READ"&&s.isCurrentUserMessage?11:-1)}}var it=(()=>{let i=class i{constructor(){this.message=null,this.prevMessage=null}get isCurrentUserMessage(){return this.message?this.currentTeamMemberId===this.message.senderId:!1}get isMessageFromPrevAuthor(){return!this.prevMessage||!this.message?!1:this.message.senderId===this.prevMessage.senderId}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=M({type:i,selectors:[["app-chats-message","currentTeamMemberId","","message","","prevMessage",""]],inputs:{currentTeamMemberId:"currentTeamMemberId",message:"message",prevMessage:"prevMessage"},attrs:bt,decls:1,vars:1,consts:[["contextMenu","matMenu"],[1,"message",3,"current-user__message","message-with-previous"],[1,"message"],["src","","alt","",1,"message__icon"],[1,"message__details"],[1,"message__header"],[1,"message__body"],[1,"message__body-text"],[1,"message__body-details"],["src","assets/images/icons/chat-check.svg","alt","check"],["mat-menu-item",""],[1,"message__header-author"]],template:function(t,r){t&1&&u(0,yt,16,15,"div",1),t&2&&f(0,r.message?0:-1)},dependencies:[ie,re,ne,ge],styles:[".message[_ngcontent-%COMP%]{display:flex;gap:16px;max-width:80%;align-items:flex-start}@media (max-width: 40em){.message[_ngcontent-%COMP%]{max-width:95%}}.message__icon[_ngcontent-%COMP%]{flex-shrink:0;width:40px;height:40px;border-radius:9999px;background:#9e9e9e}.message__header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:12px}.message__header-author[_ngcontent-%COMP%]{font-weight:600}.message__header-date[_ngcontent-%COMP%]{color:#7a7a7a}.message__body[_ngcontent-%COMP%]{position:relative;margin-top:6px;padding:8px 16px;border-radius:10px;background:#e6e6e6}.message__body-details[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:6px;font-size:12px}.message__body-details[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.context-menu-trigger[_ngcontent-%COMP%]{position:absolute}.current-user__message[_ngcontent-%COMP%]{justify-content:flex-end;float:right}.current-user__body[_ngcontent-%COMP%]{background:#068e44;color:#fff}.message-with-previous[_ngcontent-%COMP%]{margin-top:-22px;padding-left:54px}"],changeDetection:0});let n=i;return n})();var wt=(n,i)=>i.id,Tt=()=>["../"];function kt(n,i){n&1&&(a(0,"button",5)(1,"mat-icon"),m(2,"chevron_left"),o()()),n&2&&d("routerLink",Ge(1,Tt))}function It(n,i){if(n&1&&(a(0,"p",8),m(1),o()),n&2){let s=h(2);c(),y("",s.size," Members")}}function Rt(n,i){if(n&1){let s=K();a(0,"button",12),b("click",function(){z(s);let t=h(2),r=h();return H(r.onEditClick(t))}),a(1,"mat-icon"),m(2,"edit"),o(),a(3,"span"),m(4,"Edit"),o()()}}function $t(n,i){if(n&1&&(v(0,"app-chats-message",20),m(1)),n&2){let s=i.$implicit,e=i.$index,t=i.$index,r=i.$count,l=h(),k=h(),dt=h(2);d("currentTeamMemberId",k.id)("message",s)("prevMessage",l[e-1]),c(),y(" ",t===r-1?dt.scrollToBottom():""," ")}}function Dt(n,i){n&1&&I(0,$t,2,4,null,null,wt),n&2&&R(i)}function Pt(n,i){if(n&1){let s=K();a(0,"div",2)(1,"div",3)(2,"div",4),u(3,kt,3,2,"button",5),a(4,"div",6)(5,"h3",7),m(6),o(),u(7,It,2,1,"p",8),o()(),a(8,"div",9)(9,"button",10)(10,"mat-icon"),m(11,"more_vert"),o()(),a(12,"mat-menu",null,0),u(14,Rt,5,0,"button",11),a(15,"button",12),b("click",function(){z(s);let t=h(),r=h();return H(r.onDeleteClick(t))}),a(16,"mat-icon"),m(17,"delete"),o(),a(18,"span"),m(19,"Remove"),o()()()()(),a(20,"div",13)(21,"div",14),u(22,Dt,2,0),g(23,"async"),o()(),a(24,"div",15)(25,"form",16),v(26,"input",17),a(27,"button",18),b("click",function(){z(s);let t=h(2);return H(t.onSendMessage())}),a(28,"mat-icon",19),m(29,"send"),o()()()()()}if(n&2){let s,e=Ce(13),t=h(),r=h();c(3),f(3,r.includeBackButton?3:-1),c(3),$(t.name),c(),f(7,t.type==="GROUP"?7:-1),c(2),d("matMenuTriggerFor",e),c(5),f(14,t.type==="GROUP"?14:-1),c(8),f(22,(s=x(23,9,r.messages$))?22:-1,s),c(3),d("formGroup",r.form),c(2),d("disabled",r.form.invalid),c(),d("color",r.form.invalid?"primary":"acccent")}}function Ot(n,i){if(n&1&&(u(0,Pt,30,11,"div",2),g(1,"async")),n&2){let s,e=h();f(0,(s=x(1,1,e.currentTeamMember$))?0:-1,s)}}var Ie=(()=>{let i=class i{constructor(e,t,r,l,k){this.chatsService=e,this.toastService=t,this.dialog=r,this.teamsService=l,this.cd=k,this.unsubscribe$=new Y,this.includeBackButton=!1,this.currentChat$=this.chatsService.currentChatRoom$,this.messages$=this.chatsService.currentChatRoomMessages$,this.currentTeamMember$=this.teamsService.currentTeamMember$,this.form=new N({content:new w("",[E.required,E.maxLength(2048),E.minLength(1)])})}ngOnInit(){this.chatsService.getHistoryMessages().pipe(U(e=>(this.toastService.error("Failed to get messages history"),_(()=>e))),de(this.unsubscribe$)).subscribe(e=>{this.chatsService.addMessage(e)}),this.chatsService.subscribeCurrentChatMessages().pipe(U(e=>(this.toastService.error("Failed to receive messages"),_(()=>e))),de(this.unsubscribe$)).subscribe(e=>{e&&this.chatsService.addMessage(e)}),this.scrollToBottom()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}scrollToBottom(){let e=document.getElementById("chatsContainerId");e&&(e.scrollTop=e.scrollHeight)}onSendMessage(){let{content:e}=this.form.getRawValue();if(!e){this.toastService.error("Missing content");return}this.currentTeamMember$.pipe(C(t=>{if(!t)return this.toastService.error("Missing member"),W;if(!e.trim())return W;let r={content:e.trim(),type:Ne.TEXT,senderId:t.id};return this.chatsService.sendMessageByCurrentChat(r)}),U(t=>(this.toastService.error("Failed to send message"),_(()=>t))),L(1)).subscribe(()=>{this.form.reset({content:""})})}onDeleteClick(e){this.chatsService.deleteChatRoom(e.id).pipe(U(t=>(this.toastService.error("Failed to delete chat"),_(()=>t))),L(1)).subscribe(()=>{this.toastService.open("Successfully deleted chat"),this.chatsService.setCurrentChat(null),this.chatsService.refetchChats()})}onEditClick(e){this.dialog.open(Ze,{minWidth:"30%",data:{chat:e}}).afterClosed().pipe(C(r=>r?this.chatsService.updateChatRoom(e.id,r):W),C(()=>this.chatsService.getChatRoomById(e.id)),U(r=>(this.toastService.error("Failed to update chat"),_(()=>r))),L(1)).subscribe(r=>{this.toastService.open("Successfully updated chat"),this.chatsService.setCurrentChat(r),this.chatsService.refetchChats()})}};i.\u0275fac=function(t){return new(t||i)(p(G),p(D),p(Me),p(P),p(Z))},i.\u0275cmp=M({type:i,selectors:[["app-chat-room"]],inputs:{includeBackButton:"includeBackButton"},decls:3,vars:3,consts:[["moreMenu","matMenu"],[1,"chats__wrapper"],[1,"chats__content"],[1,"chats__navbar"],[1,"chats__navbar-left"],[1,"chats__navbar-back",3,"routerLink"],[1,"chats__navbar-header"],[1,"chats__navbar-name"],[1,"chats__navbar-details"],[1,"chats__navbar-right"],["aria-label","More options menu button",3,"matMenuTriggerFor"],["mat-menu-item",""],["mat-menu-item","",3,"click"],[1,"chats__messages-wrapper"],["id","chatsContainerId",1,"chats__messages"],[1,"chats__tabbar"],[1,"chats__tabbar-wrapper",3,"formGroup"],["formControlName","content","type","text","placeholder","Message",1,"chats__tabbar-input"],["type","button","type","submit",1,"chats__tabbar-send",3,"click","disabled"],[3,"color"],[3,"currentTeamMemberId","message","prevMessage"]],template:function(t,r){if(t&1&&(a(0,"section",1),u(1,Ot,2,3),g(2,"async"),o()),t&2){let l;c(),f(1,(l=x(2,1,r.currentChat$))?1:-1,l)}},dependencies:[ie,re,ne,xe,j,q,O,F,A,B,ve,it,S],styles:[".chats__wrapper[_ngcontent-%COMP%]{height:100%;padding:16px}.chats__content[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background:#fff;border:1px solid #e6eaee;border-radius:8px}@media (max-width: 40em){.chats__content[_ngcontent-%COMP%]{margin:0}}.chats__navbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:12px;align-items:center;padding:14px 22px;border-bottom:1px solid #e6eaee}.chats__navbar-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.chats__navbar-back[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#a3a3a3;width:32px;height:32px;font-size:32px}.chats__navbar-name[_ngcontent-%COMP%]{font-size:16px;font-weight:700}.chats__navbar-details[_ngcontent-%COMP%]{margin-top:4px;font-size:12px;color:#7a7a7a}.chats__messages[_ngcontent-%COMP%]{overflow-y:auto;height:100%;display:flex;flex-direction:column;gap:22px;-ms-overflow-style:none;scrollbar-width:none}.chats__messages-wrapper[_ngcontent-%COMP%]{padding:22px;overflow:hidden;flex:1;background:#f8f8f8}.chats__messages[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.chats__tabbar[_ngcontent-%COMP%]{background:#fff;padding:14px 22px;border-top:1px solid #e6eaee}@media (max-width: 40em){.chats__tabbar[_ngcontent-%COMP%]{position:fixed;left:0;right:0;bottom:0}}.chats__tabbar-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:22px}.chats__tabbar-input[_ngcontent-%COMP%]{width:100%;padding:10px 16px;background:#f8f8f8;border:1px solid #f2f2f2;border-radius:10px}.chats__tabbar-send[_ngcontent-%COMP%]   tui-svg[_ngcontent-%COMP%]:hover{color:#068e44}"],changeDetection:0});let n=i;return n})();function Ft(n,i){n&1&&v(0,"app-chat-room",1),n&2&&d("includeBackButton",!0)}var at=(()=>{let i=class i{constructor(e,t,r){this.route=e,this.chatsService=t,this.cd=r,this.currentChatRoom$=this.chatsService.currentChatRoom$;let l=this.route.snapshot.paramMap.get("id");l&&!isNaN(Number(l))&&this.chatsService.getChatRoomById(Number(l)).pipe(L(1)).subscribe(k=>{this.chatsService.setCurrentChat(k),this.cd.markForCheck()})}};i.\u0275fac=function(t){return new(t||i)(p(Ve),p(G),p(Z))},i.\u0275cmp=M({type:i,selectors:[["app-chat"]],decls:3,vars:3,consts:[[1,"chat"],[3,"includeBackButton"]],template:function(t,r){if(t&1&&(a(0,"main",0),u(1,Ft,1,1,"app-chat-room",1),g(2,"async"),o()),t&2){let l;c(),f(1,(l=x(2,1,r.currentChatRoom$))?1:-1,l)}},dependencies:[Ie,S],styles:[".chat[_ngcontent-%COMP%]{position:relative;height:100%}"],changeDetection:0});let n=i;return n})();var ue=function(n){return n.DIRECT="DIRECT",n.GROUP="GROUP",n}(ue||{});var Nt=(n,i)=>i.id;function jt(n,i){if(n&1&&(a(0,"mat-option",6),m(1),o()),n&2){let s=i.$implicit;d("value",s.id),c(),$(s.fullName)}}var ot=(()=>{let i=class i{constructor(e,t,r){this.dialogRef=e,this.teamsService=t,this.toastService=r,this.form=new N({name:new w("",[E.required]),teamMembersIds:new w([],[E.required])}),this.members$=this.teamsService.getAllTeamMembersExceptCurrent()}onBackClick(){this.dialogRef.close()}onSubmitClick(){let{name:e,teamMembersIds:t}=this.form.getRawValue();if(!e||!t){this.toastService.error("Missing required fields");return}let r={name:e,type:ue.GROUP,teamMembersIds:t};this.dialogRef.close(r)}};i.\u0275fac=function(t){return new(t||i)(p(ae),p(P),p(D))},i.\u0275cmp=M({type:i,selectors:[["app-create-group-dialog"]],decls:20,vars:4,consts:[["mat-dialog-title","",1,"create-chat__title"],["mat-dialog-content",""],[1,"create-chat__form",3,"formGroup"],["appearance","outline"],["matInput","","formControlName","name"],["formControlName","teamMembersIds","multiple",""],[3,"value"],["align","end"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary","cdkFocusInitial","",3,"click","disabled"]],template:function(t,r){t&1&&(a(0,"h1",0),m(1,` Create a new group chat
`),o(),a(2,"section",1)(3,"form",2)(4,"mat-form-field",3)(5,"mat-label"),m(6,"Group Name"),o(),v(7,"input",4),o(),a(8,"mat-form-field",3)(9,"mat-label"),m(10,"Members"),o(),a(11,"mat-select",5),I(12,jt,2,2,"mat-option",6,Nt),g(14,"async"),o()()()(),a(15,"mat-dialog-actions",7)(16,"button",8),b("click",function(){return r.onBackClick()}),m(17," Back "),o(),a(18,"button",9),b("click",function(){return r.onSubmitClick()}),m(19," Create "),o()()),t&2&&(c(3),d("formGroup",r.form),c(9),R(x(14,2,r.members$)),c(6),d("disabled",r.form.invalid))},dependencies:[te,Se,le,me,pe,ee,oe,ce,se,j,q,O,F,A,B,S],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.create-chat__title[_ngcontent-%COMP%]{font-size:20px;font-weight:500}.create-chat__form[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:22px}"],changeDetection:0});let n=i;return n})();var At=(n,i)=>i.id;function Bt(n,i){if(n&1&&(a(0,"mat-option",5),m(1),o()),n&2){let s=i.$implicit;d("value",s.id),c(),$(s.fullName)}}var st=(()=>{let i=class i{constructor(e,t,r){this.dialogRef=e,this.teamsService=t,this.toastService=r,this.form=new N({teamMemberId:new w(null,[E.required])}),this.members$=this.teamsService.getAllTeamMembersExceptCurrent()}onBackClick(){this.dialogRef.close()}onSubmitClick(){let{teamMemberId:e}=this.form.getRawValue();if(!e){this.toastService.error("Missing team member id");return}let t={name:"",type:ue.DIRECT,teamMembersIds:[e]};this.dialogRef.close(t)}};i.\u0275fac=function(t){return new(t||i)(p(ae),p(P),p(D))},i.\u0275cmp=M({type:i,selectors:[["app-create-single-dialog"]],decls:16,vars:4,consts:[["mat-dialog-title","",1,"create-chat__title"],["mat-dialog-content",""],[1,"create-chat__form",3,"formGroup"],["appearance","outline"],["formControlName","teamMemberId"],[3,"value"],["align","end"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary","cdkFocusInitial","",3,"click","disabled"]],template:function(t,r){t&1&&(a(0,"h1",0),m(1,` Create a new single chat
`),o(),a(2,"section",1)(3,"form",2)(4,"mat-form-field",3)(5,"mat-label"),m(6,"Members"),o(),a(7,"mat-select",4),I(8,Bt,2,2,"mat-option",5,At),g(10,"async"),o()()()(),a(11,"mat-dialog-actions",6)(12,"button",7),b("click",function(){return r.onBackClick()}),m(13," Back "),o(),a(14,"button",8),b("click",function(){return r.onSubmitClick()}),m(15," Create "),o()()),t&2&&(c(3),d("formGroup",r.form),c(5),R(x(10,2,r.members$)),c(6),d("disabled",r.form.invalid))},dependencies:[te,le,me,pe,ee,oe,ce,se,j,O,F,A,B,S],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.create-chat__title[_ngcontent-%COMP%]{font-size:20px;font-weight:500}.create-chat__form[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:22px}"],changeDetection:0});let n=i;return n})();var ct=(n,i)=>i.id,Gt=n=>({value:n}),Ut=n=>[n];function Vt(n,i){if(n&1&&(a(0,"p",17),m(1),g(2,"date"),o()),n&2){let s=h().$implicit;c(),y(" ",he(2,1,s.lastMessageDate,"HH:mm")," ")}}function Lt(n,i){if(n&1&&(a(0,"p",18),m(1),o()),n&2){let s=h().$implicit;c(),y(" ",s.lastMessageContent," ")}}function zt(n,i){if(n&1){let s=K();a(0,"button",12),b("click",function(){let t=z(s).$implicit,r=h(3);return H(r.onSelectChat(t))}),v(1,"img",13),a(2,"div",14)(3,"div",15)(4,"p",16),m(5),o(),u(6,Vt,3,4,"p",17),o(),u(7,Lt,2,1,"p",18),o()()}if(n&2){let s=i.$implicit,e=h();Q("sidebar__item-active",(e.value==null?null:e.value.id)===s.id),c(),d("src",s.iconId,Pe),c(4),$(s.name),c(),f(6,s.lastMessageDate?6:-1),c(),f(7,s.lastMessageContent?7:-1)}}function Ht(n,i){if(n&1&&(a(0,"p",17),m(1),g(2,"date"),o()),n&2){let s=h().$implicit;c(),y(" ",he(2,1,s.lastMessageDate,"HH:mm")," ")}}function qt(n,i){if(n&1&&(a(0,"div",18),m(1),o()),n&2){let s=h().$implicit;c(),y(" ",s.lastMessageContent," ")}}function Wt(n,i){if(n&1&&(a(0,"div",19),v(1,"img",13),a(2,"div",14)(3,"div",15)(4,"p",16),m(5),o(),u(6,Ht,3,4,"p",17),o(),u(7,qt,2,1,"div",18),o()()),n&2){let s=i.$implicit,e=h();Q("sidebar__item-active",(e.value==null?null:e.value.id)===s.id),d("routerLink",Oe(7,Ut,s.id)),c(),d("src",s.iconId,Pe),c(4),$(s.name),c(),f(6,s.lastMessageDate?6:-1),c(),f(7,s.lastMessageContent?7:-1)}}function Xt(n,i){if(n&1&&(a(0,"div",8),I(1,zt,8,6,"button",9,ct),o(),a(3,"div",10),I(4,Wt,8,9,"div",11,ct),o()),n&2){let s=h();c(),R(s),c(3),R(s)}}function Yt(n,i){if(n&1&&(u(0,Xt,6,0),g(1,"async")),n&2){let s,e=h();f(0,(s=Oe(3,Gt,x(1,1,e.currentChatRoom$)))?0:-1,s)}}var mt=(()=>{let i=class i{constructor(e,t,r){this.dialog=e,this.chatsService=t,this.toastrService=r,this.selectedChatId=new Be,this.unsubscribe$=new Y,this.filter={},this.searchForm=new N({value:new w("")}),this.currentChatRoom$=this.chatsService.currentChatRoom$,this.chats$=this.chatsService.refetchChats$.pipe(Ae([]),C(()=>this.loadChats()))}ngOnInit(){this.trackChangesChats()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}chatsTrackBy(e,t){return t.id}trackChangesChats(){this.searchForm.valueChanges.pipe(je(500),de(this.unsubscribe$)).subscribe(e=>{let{value:t}=e,r={searchValue:t??void 0};this.filter=r,this.chatsService.refetchChats()})}loadChats(){return this.chatsService.getChatRooms(this.filter)}onSelectChat(e){e&&this.selectedChatId.emit(e.id)}onCreateGroupClick(){this.dialog.open(ot,{minWidth:"30%",data:{}}).afterClosed().pipe(C(t=>t?this.chatsService.createChatRoom(t):W),U(t=>(this.toastrService.error("Failed to create chat room"),_(()=>t)))).subscribe(()=>{this.toastrService.error("Successfully created chat"),this.chatsService.refetchChats()})}onCreateSingleClick(){this.dialog.open(st,{minWidth:"30%",data:{}}).afterClosed().pipe(C(t=>t?this.chatsService.createChatRoom(t):W),U(t=>(this.toastrService.error("Failed to create chat room"),_(()=>t)))).subscribe(()=>{this.toastrService.error("Successfully created chat"),this.chatsService.refetchChats()})}};i.\u0275fac=function(t){return new(t||i)(p(Me),p(G),p(D))},i.\u0275cmp=M({type:i,selectors:[["app-chats-sidebar"]],outputs:{selectedChatId:"selectedChatId"},decls:24,vars:5,consts:[["createMenu","matMenu"],[1,"sidebar-wrapper"],[1,"sidebar"],[1,"create_chat"],[3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"sidebar__search",3,"formGroup"],["placeholder","Search","type","text","formControlName","value",1,"sidebar__search-input"],[1,"sidebar__list","desktop"],[1,"sidebar__item",3,"sidebar__item-active"],[1,"sidebar__list","mobile"],[1,"sidebar__item",3,"routerLink","sidebar__item-active"],[1,"sidebar__item",3,"click"],["alt","icon",1,"sidebar__item-icon",3,"src"],[1,"sidebar__item-details"],[1,"sidebar__item-header"],[1,"sidebar__item-header-label"],[1,"sidebar__item-header-time"],[1,"sidebar__item-body"],[1,"sidebar__item",3,"routerLink"]],template:function(t,r){if(t&1){let l=K();a(0,"aside",1)(1,"section",2)(2,"div",3)(3,"h4"),m(4,"Messages"),o(),a(5,"button",4)(6,"mat-icon"),m(7,"add"),o()(),a(8,"mat-menu",null,0)(10,"button",5),b("click",function(){return z(l),H(r.onCreateSingleClick())}),a(11,"mat-icon"),m(12,"person"),o(),a(13,"span"),m(14,"Personal chat"),o()(),a(15,"button",5),b("click",function(){return z(l),H(r.onCreateGroupClick())}),a(16,"mat-icon"),m(17,"group"),o(),a(18,"span"),m(19,"Group chat"),o()()()(),a(20,"form",6),v(21,"input",7),o(),u(22,Yt,2,5),g(23,"async"),o()()}if(t&2){let l,k=Ce(9);c(5),d("matMenuTriggerFor",k),c(15),d("formGroup",r.searchForm),c(2),f(22,(l=x(23,3,r.chats$))?22:-1,l)}},dependencies:[ie,re,ne,xe,j,q,O,F,A,B,ve,S,ge],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}.sidebar[_ngcontent-%COMP%]{width:unset;height:100%;overflow-y:auto;border-radius:8px;background:#fff;color:#242424;border:1px solid #e6eaee}.sidebar-wrapper[_ngcontent-%COMP%]{height:100%;padding:16px}@media (min-width: 48em){.sidebar[_ngcontent-%COMP%]{width:350px}}.sidebar__search[_ngcontent-%COMP%]{padding:0 22px}@media (max-width: 48em){.sidebar__search[_ngcontent-%COMP%]{padding:12px 8px}}.sidebar__search-input[_ngcontent-%COMP%]{width:100%;padding:10px 16px;border:1px solid #f2f2f2;border-radius:10px}.sidebar__list[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;gap:6px;padding:18px 22px 22px}@media (min-width: 48em){.sidebar__list.mobile[_ngcontent-%COMP%]{display:none}}.sidebar__list.desktop[_ngcontent-%COMP%]{display:none}@media (min-width: 48em){.sidebar__list.desktop[_ngcontent-%COMP%]{display:flex}}.sidebar__item[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;gap:.8rem;padding:10px 12px;border-radius:8px;cursor:pointer}.sidebar__item-active[_ngcontent-%COMP%]{background:#f0f4f8;color:#242424}.sidebar__item[_ngcontent-%COMP%]:hover{background:#f0f4f8}.sidebar__item-icon[_ngcontent-%COMP%]{flex-shrink:0;display:block;width:38px;height:38px;border-radius:9999px;background:#6668db}.sidebar__item-details[_ngcontent-%COMP%]{width:86%;display:flex;flex-direction:column;align-items:start}.sidebar__item-header[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;gap:8px}.sidebar__item-header-label[_ngcontent-%COMP%]{font-weight:500;text-overflow:ellipsis;overflow-x:hidden;text-wrap:nowrap}.sidebar__item-header-time[_ngcontent-%COMP%]{font-size:12px;color:#7a7a7a}.sidebar__item-body[_ngcontent-%COMP%]{width:100%;text-align:left;margin-top:4px;font-size:12px;text-overflow:ellipsis;overflow-x:hidden;text-wrap:nowrap}.create_chat[_ngcontent-%COMP%]{position:sticky;top:0;padding:22px 22px 26px;display:flex;align-items:center;justify-content:space-between;gap:12px;background:#fff}.create_chat[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:20px;font-weight:500}.create_chat[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;background:#068e44;padding:4px;border-radius:9999px}.create_chat[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;color:#f4f5f5}"],changeDetection:0});let n=i;return n})();function Qt(n,i){n&1&&v(0,"app-chat-room")}function Kt(n,i){n&1&&(a(0,"div",3)(1,"p",4),m(2,"Select chat"),o()())}var lt=(()=>{let i=class i{constructor(e,t){this.cd=e,this.chatsService=t,this.currentChatRoom$=this.chatsService.currentChatRoom$}onSelectChat(e){this.chatsService.getChatRoomById(e).pipe(L(1)).subscribe(t=>{this.chatsService.setCurrentChat(t),this.cd.markForCheck()})}};i.\u0275fac=function(t){return new(t||i)(p(Z),p(G))},i.\u0275cmp=M({type:i,selectors:[["app-chats"]],decls:6,vars:3,consts:[[1,"chats-wrapper"],[3,"selectedChatId"],[1,"chat-container"],[1,"empty-chat__wrapper"],[1,"empty-chat__label"]],template:function(t,r){if(t&1&&(a(0,"div",0)(1,"app-chats-sidebar",1),b("selectedChatId",function(k){return r.onSelectChat(k)}),o(),a(2,"div",2),u(3,Qt,1,0,"app-chat-room"),g(4,"async"),u(5,Kt,3,0),o()()),t&2){let l;c(3),f(3,(l=x(4,1,r.currentChatRoom$))?3:5,l)}},dependencies:[mt,Ie,S],styles:[".chats-wrapper[_ngcontent-%COMP%]{width:100%;height:100%}@media (min-width: 48em){.chats-wrapper[_ngcontent-%COMP%]{display:flex}}.chat-container[_ngcontent-%COMP%]{display:none}@media (min-width: 48em){.chat-container[_ngcontent-%COMP%]{flex:1 1 auto;display:block}}.empty-chat__wrapper[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center;justify-content:center}.empty-chat__label[_ngcontent-%COMP%]{font-size:16px;color:#bdbdbd}"],changeDetection:0});let n=i;return n})();var Zt=[{path:"",component:lt},{path:":id",component:at}],pt=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=_e({type:i}),i.\u0275inj=fe({imports:[Fe.forChild(Zt),Fe]});let n=i;return n})();var en=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=_e({type:i}),i.\u0275inj=fe({providers:[G],imports:[Ue,He,pt]});let n=i;return n})();export{en as ChatsModule};
